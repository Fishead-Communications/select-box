/*
 jQuery Selectbox plugin 0.3

 Copyright 2011-2015, Dimitar Ivanov (http://www.bulgaria-web-developers.com/projects/javascript/selectbox/)
 Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.

 Date: Sat Nov 21 23:20:59 2015 +0300
 Copyright 2018 Adrian Green (https://github.com/Fishead-Communications/select-box)
 Adds keyboard handling
*/
(function(b,q){function m(){this._state=[];this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}b.extend(m.prototype,{_isOpenSelectbox:function(b){return b?this._getInst(b).isOpen:!1},_isDisabledSelectbox:function(b){return b?
this._getInst(b).isDisabled:!1},_attachSelectbox:function(c,a){function g(){var a,c,e=this.attr("id").split("_")[1];for(a in h._state)a!==e&&h._state.hasOwnProperty(a)&&(c=b("select[sb='"+a+"']")[0])&&h._closeSelectbox(c)}function d(a,d){var p=d&&d.sub?!0:!1,f=d&&d.disabled?!0:!1;a.each(function(a){var d=b(this),k=b("<li>");d.is(":selected")&&(r.text(d.text()),m=!0);a===q-1&&k.addClass("last");d.is(":disabled")||f?(a=b("<span>",{text:d.text()}).addClass(e.settings.classDisabled),p&&a.addClass(e.settings.classSub)):
(a=b("<a>",{href:"#"+d.val(),rel:d.val(),"x-accesskey":d.text().charAt(0).toLowerCase()}).text(d.text()).bind("click.sb",function(a){a&&a.preventDefault&&a.preventDefault();a=u;var d=b(this);a.attr("id").split("_");h._changeSelectbox(c,d.attr("rel"),d.text());h._closeSelectbox(c)}).bind("mouseover.sb",function(){var a=b(this);a.parent().siblings().find("a").removeClass(e.settings.classFocus);a.addClass(e.settings.classFocus)}).bind("mouseout.sb",function(){b(this).removeClass(e.settings.classFocus)}),
p&&a.addClass(e.settings.classSub),d.is(":selected")&&a.addClass(e.settings.classFocus));a.appendTo(k);k.appendTo(t)})}if(this._getInst(c))return!1;var f=b(c),h=this,e=h._newInst(f),m=!1;f.find("optgroup");var v=f.find("option"),q=v.length;f.attr("sb",e.uid);b.extend(e.settings,h._defaults,a);h._state[e.uid]=!1;f.hide();var n=b("<div>",{id:"sbHolder_"+e.uid,"class":e.settings.classHolder,tabindex:f.attr("tabindex")});var r=b("<a>",{id:"sbSelector_"+e.uid,href:"#","class":e.settings.classSelector,
click:function(a){a.preventDefault();g.apply(b(this),[]);a=b(this).attr("id").split("_")[1];h._state[a]?h._closeSelectbox(c):h._openSelectbox(c)}});var u=b("<a>",{id:"sbToggle_"+e.uid,href:"#","class":e.settings.classToggle,click:function(a){a.preventDefault();g.apply(b(this),[]);a=b(this).attr("id").split("_")[1];h._state[a]?h._closeSelectbox(c):h._openSelectbox(c)}});u.appendTo(n);var t=b("<ul>",{id:"sbOptions_"+e.uid,"class":e.settings.classOptions,css:{display:"none"}});f.children().each(function(a){a=
b(this);var c={};if(a.is("option"))d(a);else if(a.is("optgroup")){var h=b("<li>");b("<span>",{text:a.attr("label")}).addClass(e.settings.classGroup).appendTo(h);h.appendTo(t);a.is(":disabled")&&(c.disabled=!0);c.sub=!0;d(a.find("option"),c)}});m||r.text(v.first().text());b.data(c,"selectbox",e);n.data("uid",e.uid).bind("keydown.sb",function(a){var c=a.charCode?a.charCode:a.keyCode?a.keyCode:0,d=b(this),e=d.data("uid"),f=d.siblings("select[sb='"+e+"']").data("selectbox"),g=d.siblings(["select[sb='",
e,"']"].join("")).get(0),k=d.find("ul").find("a."+f.settings.classFocus),p=[37,38,39,40,13,9,27];switch(c){case 37:case 38:if(0<k.length){b("a",d).removeClass(f.settings.classFocus);var l=k.parent().prevAll("li:has(a)").eq(0).find("a");0<l.length&&(l.addClass(f.settings.classFocus).focus(),b("#sbSelector_"+e).text(l.text()))}break;case 39:case 40:b("a",d).removeClass(f.settings.classFocus);l=0<k.length?k.parent().nextAll("li:has(a)").eq(0).find("a"):d.find("ul").find("a").eq(0);0<l.length&&(l.addClass(f.settings.classFocus).focus(),
b("#sbSelector_"+e).text(l.text()));break;case 13:0<k.length&&h._changeSelectbox(g,k.attr("rel"),k.text());h._closeSelectbox(g);break;case 9:g&&(f=h._getInst(g))&&(0<k.length&&h._changeSelectbox(g,k.attr("rel"),k.text()),h._closeSelectbox(g));g=parseInt(d.attr("tabindex"),10);a.shiftKey?g--:g++;b("*[tabindex='"+g+"']").focus();break;case 27:h._closeSelectbox(g)}/[a-z0-9]/i.test(a.key)&&-1===p.indexOf(c)&&(b("a",d).removeClass(f.settings.classFocus),0<k.length&&(l=k.parent().nextAll("li:has(a)").eq(0).find("a[x-accesskey='"+
a.key+"']")),0===l.length&&(l=d.find("ul").find("a[x-accesskey='"+a.key+"']").eq(0)),0<l.length&&(l.addClass(f.settings.classFocus).focus(),b("#sbSelector_"+e).text(l.text())));a.stopPropagation();return!1}).delegate("a","mouseover",function(a){b(this).addClass(e.settings.classFocus)}).delegate("a","mouseout",function(a){b(this).removeClass(e.settings.classFocus)});r.appendTo(n);t.appendTo(n);n.insertAfter(f);b("html").on("mousedown",function(a){a.stopPropagation();b("select").selectbox("close")});
b([".",e.settings.classHolder,", .",e.settings.classSelector].join("")).mousedown(function(a){a.stopPropagation()})},_detachSelectbox:function(c){var a=this._getInst(c);if(!a)return!1;b("#sbHolder_"+a.uid).remove();b.data(c,"selectbox",null);b(c).show()},_changeSelectbox:function(c,a,g){var d=this._getInst(c);if(d){var f=this._get(d,"onChange");b("#sbSelector_"+d.uid).text(g)}a=a.replace(/'/g,"\\'");b(c).find("option[value='"+a+"']").prop("selected",!0);d&&f?f.apply(d.input?d.input[0]:null,[a,d]):
d&&d.input&&d.input.trigger("change")},_enableSelectbox:function(c){var a=this._getInst(c);if(!a||!a.isDisabled)return!1;b("#sbHolder_"+a.uid).removeClass(a.settings.classHolderDisabled);a.isDisabled=!1;b.data(c,"selectbox",a)},_disableSelectbox:function(c){var a=this._getInst(c);if(!a||a.isDisabled)return!1;b("#sbHolder_"+a.uid).addClass(a.settings.classHolderDisabled);a.isDisabled=!0;b.data(c,"selectbox",a)},_optionSelectbox:function(c,a,g){var d=this._getInst(c);if(!d)return!1;d[a]=g;b.data(c,
"selectbox",d)},_openSelectbox:function(c){var a=this._getInst(c);if(a&&!a.isOpen&&!a.isDisabled){var g=b("#sbOptions_"+a.uid),d=parseInt(b(window).height(),10),f=b("#sbHolder_"+a.uid).offset(),h=b(window).scrollTop(),e=g.prev().height();d=d-(f.top-h)-e/2;f=this._get(a,"onOpen");g.css({top:e+"px",maxHeight:d-e+"px"});"fade"===a.settings.effect?g.fadeIn(a.settings.speed):g.slideDown(a.settings.speed);b("#sbToggle_"+a.uid).addClass(a.settings.classToggleOpen);this._state[a.uid]=!0;a.isOpen=!0;f&&f.apply(a.input?
a.input[0]:null,[a]);b.data(c,"selectbox",a)}},_closeSelectbox:function(c){var a=this._getInst(c);if(a&&a.isOpen){var g=this._get(a,"onClose");"fade"===a.settings.effect?b("#sbOptions_"+a.uid).fadeOut(a.settings.speed):b("#sbOptions_"+a.uid).slideUp(a.settings.speed);b("#sbToggle_"+a.uid).removeClass(a.settings.classToggleOpen);this._state[a.uid]=!1;a.isOpen=!1;g&&g.apply(a.input?a.input[0]:null,[a]);b.data(c,"selectbox",a)}},_newInst:function(b){return{id:b[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),
input:b,uid:Math.floor(99999999*Math.random()),isOpen:!1,isDisabled:!1,settings:{}}},_getInst:function(c){try{return b.data(c,"selectbox")}catch(a){throw"Missing instance data for this selectbox";}},_get:function(b,a){return b.settings[a]!==q?b.settings[a]:this._defaults[a]}});b.fn.selectbox=function(c){var a=Array.prototype.slice.call(arguments,1);return"string"==typeof c&&"isDisabled"==c||"option"==c&&2==arguments.length&&"string"==typeof arguments[1]?b.selectbox["_"+c+"Selectbox"].apply(b.selectbox,
[this[0]].concat(a)):this.each(function(){"string"==typeof c?b.selectbox["_"+c+"Selectbox"].apply(b.selectbox,[this].concat(a)):b.selectbox._attachSelectbox(this,c)})};b.selectbox=new m;b.selectbox.version="0.3"})(jQuery);