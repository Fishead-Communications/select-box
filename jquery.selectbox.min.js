!function(e,s){var t="selectbox",i=!1,a=!0;function Selectbox(){this._state=[],this._defaults={classHolder:"sbHolder",classHolderDisabled:"sbHolderDisabled",classSelector:"sbSelector",classOptions:"sbOptions",classGroup:"sbGroup",classSub:"sbSub",classDisabled:"sbDisabled",classToggleOpen:"sbToggleOpen",classToggle:"sbToggle",classFocus:"sbFocus",speed:200,effect:"slide",onChange:null,onOpen:null,onClose:null}}e.extend(Selectbox.prototype,{_isOpenSelectbox:function(e){return e?this._getInst(e).isOpen:i},_isDisabledSelectbox:function(e){return e?this._getInst(e).isDisabled:i},_attachSelectbox:function(s,n){if(this._getInst(s))return i;var l,o,c,d,r=e(s),u=this,p=u._newInst(r),b=i,g=(r.find("optgroup"),r.find("option")),f=g.length;function closeOthers(){var s,t,i=this.attr("id").split("_")[1];for(s in u._state)s!==i&&u._state.hasOwnProperty(s)&&(t=e("select[sb='"+s+"']")[0])&&u._closeSelectbox(t)}function getOptions(){var t=!(!arguments[1]||!arguments[1].sub),i=!(!arguments[1]||!arguments[1].disabled);arguments[0].each(function(n){var l,r=e(this),g=e("<li>");r.is(":selected")&&(o.text(r.text()),b=a),n===f-1&&g.addClass("last"),r.is(":disabled")||i?(l=e("<span>",{text:r.text()}).addClass(p.settings.classDisabled),t&&l.addClass(p.settings.classSub),l.appendTo(g)):(l=e("<a>",{href:"#"+r.val(),rel:r.val(),"x-accesskey":r.text().charAt(0).toLowerCase()}).text(r.text()).bind("click.sb",function(t){t&&t.preventDefault&&t.preventDefault();var i=c,a=e(this);i.attr("id").split("_")[1];u._changeSelectbox(s,a.attr("rel"),a.text()),u._closeSelectbox(s)}).bind("mouseover.sb",function(){var s=e(this);s.parent().siblings().find("a").removeClass(p.settings.classFocus),s.addClass(p.settings.classFocus)}).bind("mouseout.sb",function(){e(this).removeClass(p.settings.classFocus)}),t&&l.addClass(p.settings.classSub),r.is(":selected")&&l.addClass(p.settings.classFocus),l.appendTo(g)),g.appendTo(d)})}r.attr("sb",p.uid),e.extend(p.settings,u._defaults,n),u._state[p.uid]=i,r.hide(),l=e("<div>",{id:"sbHolder_"+p.uid,class:p.settings.classHolder,tabindex:r.attr("tabindex")}),o=e("<a>",{id:"sbSelector_"+p.uid,href:"#",class:p.settings.classSelector,click:function(t){t.preventDefault(),closeOthers.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];u._state[i]?u._closeSelectbox(s):u._openSelectbox(s)}}),(c=e("<a>",{id:"sbToggle_"+p.uid,href:"#",class:p.settings.classToggle,click:function(t){t.preventDefault(),closeOthers.apply(e(this),[]);var i=e(this).attr("id").split("_")[1];u._state[i]?u._closeSelectbox(s):u._openSelectbox(s)}})).appendTo(l),d=e("<ul>",{id:"sbOptions_"+p.uid,class:p.settings.classOptions,css:{display:"none"}}),r.children().each(function(s){var t,i=e(this),a={};i.is("option")?getOptions(i):i.is("optgroup")&&(t=e("<li>"),e("<span>",{text:i.attr("label")}).addClass(p.settings.classGroup).appendTo(t),t.appendTo(d),i.is(":disabled")&&(a.disabled=!0),a.sub=!0,getOptions(i.find("option"),a))}),b||o.text(g.first().text()),e.data(s,t,p),l.data("uid",p.uid).bind("keydown.sb",function(s){var i=s.charCode?s.charCode:s.keyCode?s.keyCode:0,a=e(this),n=a.data("uid"),l=a.siblings("select[sb='"+n+"']").data(t),o=a.siblings(["select[sb='",n,"']"].join("")).get(0),c=a.find("ul").find("a."+l.settings.classFocus);switch(i){case 37:case 38:if(c.length>0)e("a",a).removeClass(l.settings.classFocus),(p=c.parent().prevAll("li:has(a)").eq(0).find("a")).length>0&&(p.addClass(l.settings.classFocus).focus(),e("#sbSelector_"+n).text(p.text()));break;case 39:case 40:e("a",a).removeClass(l.settings.classFocus),(p=c.length>0?c.parent().nextAll("li:has(a)").eq(0).find("a"):a.find("ul").find("a").eq(0)).length>0&&(p.addClass(l.settings.classFocus).focus(),e("#sbSelector_"+n).text(p.text()));break;case 13:c.length>0&&u._changeSelectbox(o,c.attr("rel"),c.text()),u._closeSelectbox(o);break;case 9:if(o){var d=(l=u._getInst(o)).isOpen;l&&l.isOpen&&(c.length>0&&u._changeSelectbox(o,c.attr("rel"),c.text()),u._closeSelectbox(o)),o&&l&&!d&&u._openSelectbox(o)}if(o&&l&&!l.isOpen){var r=parseInt(a.attr("tabindex"),10);s.shiftKey?r--:r++,e("*[tabindex='"+r+"']").focus()}break;case 27:u._closeSelectbox(o)}if(/[a-z0-9]/i.test(s.key)&&-1===[37,38,39,40,13,9,27].indexOf(i)){var p=[];e("a",a).removeClass(l.settings.classFocus),c.length>0&&(p=c.parent().nextAll("li:has(a)").eq(0).find("a[x-accesskey='"+s.key+"']")),0===p.length&&(p=a.find("ul").find("a[x-accesskey='"+s.key+"']").eq(0)),p.length>0&&(p.addClass(l.settings.classFocus).focus(),e("#sbSelector_"+n).text(p.text()))}return s.stopPropagation(),!1}).delegate("a","mouseover",function(s){e(this).addClass(p.settings.classFocus)}).delegate("a","mouseout",function(s){e(this).removeClass(p.settings.classFocus)}),o.appendTo(l),d.appendTo(l),l.insertAfter(r),e("html").on("mousedown",function(s){s.stopPropagation(),e("select").selectbox("close")}),e([".",p.settings.classHolder,", .",p.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()})},_detachSelectbox:function(s){var a=this._getInst(s);if(!a)return i;e("#sbHolder_"+a.uid).remove(),e.data(s,t,null),e(s).show()},_changeSelectbox:function(s,t,i){var n,l=this._getInst(s);l&&(n=this._get(l,"onChange"),e("#sbSelector_"+l.uid).text(i)),t=t.replace(/\'/g,"\\'"),e(s).find("option[value='"+t+"']").prop("selected",a),l&&n?n.apply(l.input?l.input[0]:null,[t,l]):l&&l.input&&l.input.trigger("change")},_enableSelectbox:function(s){var a=this._getInst(s);if(!a||!a.isDisabled)return i;e("#sbHolder_"+a.uid).removeClass(a.settings.classHolderDisabled),a.isDisabled=i,e.data(s,t,a)},_disableSelectbox:function(s){var n=this._getInst(s);if(!n||n.isDisabled)return i;e("#sbHolder_"+n.uid).addClass(n.settings.classHolderDisabled),n.isDisabled=a,e.data(s,t,n)},_optionSelectbox:function(s,a,n){var l=this._getInst(s);if(!l)return i;l[a]=n,e.data(s,t,l)},_openSelectbox:function(s){var i=this._getInst(s);if(i&&!i.isOpen&&!i.isDisabled){var n=e("#sbOptions_"+i.uid),l=parseInt(e(window).height(),10),o=e("#sbHolder_"+i.uid).offset(),c=e(window).scrollTop(),d=n.prev().height(),r=l-(o.top-c)-d/2,u=this._get(i,"onOpen");n.css({top:d+"px",maxHeight:r-d+"px"}),"fade"===i.settings.effect?n.fadeIn(i.settings.speed):n.slideDown(i.settings.speed),e("#sbToggle_"+i.uid).addClass(i.settings.classToggleOpen),this._state[i.uid]=a,i.isOpen=a,u&&u.apply(i.input?i.input[0]:null,[i]),e.data(s,t,i)}},_closeSelectbox:function(s){var a=this._getInst(s);if(a&&a.isOpen){var n=this._get(a,"onClose");"fade"===a.settings.effect?e("#sbOptions_"+a.uid).fadeOut(a.settings.speed):e("#sbOptions_"+a.uid).slideUp(a.settings.speed),e("#sbToggle_"+a.uid).removeClass(a.settings.classToggleOpen),this._state[a.uid]=i,a.isOpen=i,n&&n.apply(a.input?a.input[0]:null,[a]),e.data(s,t,a)}},_newInst:function(e){return{id:e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:e,uid:Math.floor(99999999*Math.random()),isOpen:i,isDisabled:i,settings:{}}},_getInst:function(s){try{return e.data(s,t)}catch(e){throw"Missing instance data for this selectbox"}},_get:function(e,s){return void 0!==e.settings[s]?e.settings[s]:this._defaults[s]}}),e.fn.selectbox=function(s){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof s&&"isDisabled"==s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):"option"==s&&2==arguments.length&&"string"==typeof arguments[1]?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this[0]].concat(t)):this.each(function(){"string"==typeof s?e.selectbox["_"+s+"Selectbox"].apply(e.selectbox,[this].concat(t)):e.selectbox._attachSelectbox(this,s)})},e.selectbox=new Selectbox,e.selectbox.version="0.3"}(jQuery);